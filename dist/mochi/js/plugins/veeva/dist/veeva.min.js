/*!
 * Mochi Plugin - Veeva CLM Application v1.1 (https://github.com/codeworksdev/mochi/tree/master/dist/frontend/js/plugins/veeva)
 * Copyright (c) 2014-2019 CODEWORKS <support@codeworksnyc.com>
 * Licensed under the MIT license
 */
function MochiPlugin__Veeva(){this._options(),this._init()}$(document).ready(function(t){$m.extend("veeva",MochiPlugin__Veeva)}),MochiPlugin__Veeva.prototype={_options:function(){var t={CLM_VERSION:"1.0"};t.CLM_NAME=$("html title").text(),t.CLM_ID=t.CLM_NAME.replace(/\W/g,"_").toUpperCase()+"_"+t.CLM_VERSION.replace(/\W/g,"_"),t.CLM_SLIDE_PREFIX=t.CLM_ID.toLowerCase()+"_slide",t.CLM_NUMBER_PAD=2,t.CLM_FIRST_SLIDE_NUMBER=0,t.CLM_LAST_SLIDE_NUMBER=0,t.CLM_NAVIGATION=!1,t.CLM_NAVIGATION_THEME=!1,t.CLM_FORCE_VEEVA_NAVIGATION=!1,this.default=_.clone(t),this.options=_.clone(t)},_init:function(){_.each(this.options,function(t,i){"CLM_NAVIGATION"===i&&t&&this._onOptionChange(i,{from:!1,to:!0})},this)},_onOptionChange:function(t,i){if(i.from!==i.to)switch(t){case"CLM_NAVIGATION":e=this,n=i.to,s=$("#mochi-plugin-veeva-nav"),n?(n=(o=$('<div data-mochi="plugin" id="mochi-plugin-veeva-nav"><span></span><span></span><span></span></div>')).find("> span"),$m.onClick(n.eq(0),function(){$m.veeva.goHome()}),$m.onClick(n.eq(1),function(){$m.veeva.prevSlide()}),$m.onClick(n.eq(2),function(){$m.veeva.nextSlide()}),$m.__body.append(o),e.options.CLM_NAVIGATION_THEME&&e._onOptionChange("CLM_NAVIGATION_THEME",{from:!1,to:!0})):s.remove();break;case"CLM_NAVIGATION_THEME":e=i.to,(s=$("#mochi-plugin-veeva-nav")).length&&(s=s.find("> span"),e?(s.eq(0).append('<i class="fas fa-home"></i>'),s.eq(1).append('<i class="fas fa-angle-left"></i>'),s.eq(2).append('<i class="fas fa-angle-right"></i>')):s.empty())}var e,n,o,s},goHome:function(){return this.gotoSlide()},gotoSlide:function(x,p){var d,n,c,f,v,u;return arguments.length||(x=this.options.CLM_FIRST_SLIDE_NUMBER,p=this.options.CLM_ID),/^https?:\/\//.test(x)||/\.(pdf|pptx?)$/i.test(x)?this.is_veeva()?document.location.href=x:window.open(x):(d=/^\d+(\.\d+)?$/.test(x),n=d?sprintf("%0"+this.options.CLM_NUMBER_PAD+"d"+RegExp.$1,x):x,c=p||this.options.CLM_ID,f=d?this.options.CLM_SLIDE_PREFIX+n:n,v=this.is_veeva(),u=v?"com.veeva.clm.gotoSlide('"+f+(/\.zip$/.test(f)?"":".zip")+"','"+c+"')":"document.location.href='"+f.replace(/\.zip$/,"")+".html'",!v&&/([^\/]+)\/([^\/]+)\.html$/.test(document.location.href)&&RegExp.$1==RegExp.$2&&(u=u.replace(/'(.+?)\.html'/,"'../$1/$1.html'")),eval(u)),this},getDefaultOptions:function(t,i){return this.getOptions(t,!0,i)},getOptions:function(t,i,e){var n=i?"default":"options";if(t&&_.isFunction(t)&&(e=t,t=null),!t)return _.isFunction(e)?_.mapObject(_.clone(this[n]),e,this):_.clone(this[n]);if("string"==typeof t&&_.has(this[n],t)){i=_.isFunction(this[n][t])?this[n][t]():this[n][t];return _.isFunction(e)?e.call(this,i,t,this[n]):i}},is_veeva:function(){try{return this.options.CLM_FORCE_VEEVA_NAVIGATION||/mobile\/containers\/data\/application/i.test(window.location.href)||/^https?:\/\/localhost:\d+\//.test(window.location.href)||/^[^\/]+\/\/wincrm/.test(window.location.href)?!0:void 0}catch(t){return}},nextSlide:function(t){var i=$m.getPage(),e=this.options.CLM_LAST_SLIDE_NUMBER,n=$m.__body.attr("data-next-page"),i=/^\d+(\.\d+)?$/.test(n)?n:/^(\d+)\.(\d+)$/.test(i)?(n=Number(RegExp.$2)+1,RegExp.$1+"."+n):Number(i)+1;return this.gotoSlide(i<e?i:e,t)},prevSlide:function(t){var i=$m.getPage(),e=this.options.CLM_FIRST_SLIDE_NUMBER,n=$m.__body.attr("data-prev-page"),i=/^\d+(\.\d+)?$/.test(n)?n:/^(\d+)\.(\d+)$/.test(i)?e<(n=Number(RegExp.$2)-1)?RegExp.$1+"."+n:RegExp.$1:Number(i)-1;return this.gotoSlide(i<e?e:i,t)},setOptions:function(t,i){var e;return arguments.length?_.isFunction(t)?(e=_.clone(this.default),i=t):e=_.clone($m.isSimpleObj(t)?t:this.default):e=_.clone(this.default),_.each(e,function(t,i){_.has(this.options,i)&&(this._onOptionChange(i,{from:this.options[i],to:t}),this.options[i]=t)},this),i&&_.isFunction(i)&&i.call(this,e),this}};
